import lightgbm
import matplotlib.pyplot as plt
from DataProcessing.LoadData import dat_to_train_test


class LightGBM_Booster:
	def __init__(self):
		"""
		Constructor for LightGBM Booster Model

		"""

		# How to init?
		self.booster_model = []

	def train(self, dataset: lightgbm.basic.Dataset, num_iterations: int = 1000, learning_rate: float = 0.05,
			  num_leaves: int = 2048, max_depth: int = 15, min_data_in_leaf: int = 50, feature_fraction: float = 0.5):
		"""
		Training method for LightGBM Boosting model

		:param num_leaves: Number of leaves in a tree
		:param max_depth: Maximum depth of a decision tree
		:param min_data_in_leaf:
		:param feature_fraction:
		:param learning_rate: Learning rate for the model training
		:param num_iterations: Number of iterations/epochs
		:param dataset: lightGBM dataset object containing the training data
		:return:
		"""

		# Parameters for lightgbm take in a dict
		parameters = {
			"boosting": "gbdt",
			"objective": "binary",
			"num_iterations": num_iterations,
			"learning_rate": learning_rate,
			"num_leaves": num_leaves,
			"max_depth": max_depth,
			"min_data_in_leaf": min_data_in_leaf,
			"feature_fraction": feature_fraction}

		self.booster_model = lightgbm.train(train_set=dataset, params=parameters)
		return self.booster_model


	def create_training_dataset(self, dataset_dir: str):
		"""
		Creates an object of type LightGBM dataset containing the data

		:param dataset_dir: Directory where the dataset is contained
		:return: LightGBM dataset representation of dataset
		"""

		# Get data
		x_train, y_train, x_test, y_test = dat_to_train_test(dataset_dir)

		# Remove -1 from the dataset
		filtered_rows = (y_train != 1)

		return lightgbm.Dataset(x_train[filtered_rows], y_train[filtered_rows])
